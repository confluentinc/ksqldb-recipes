<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Fleet Management - ksqlDB Recipes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Fleet Management";
    var mkdocs_page_input_path = "retail/fleet_management/index.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> ksqlDB Recipes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">ksqlDB Recipes</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Customer 360</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Clickstream</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../customer-360/clickstream/">Clickstream Data Analysis</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Fin serv</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Credit card activity</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../fin-serv/credit-card-activity/">Detecting Unusual Credit Card Activity</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Denormalization</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../fin-serv/denormalization/">Change Data Capture (CDC) for Orders</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Retail</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Fleet management</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Fleet Management</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#what-is-it">What is it?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-started">Get Started</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-by-step">Step-by-step</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#setup-your-environment">Setup your Environment</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#read-the-data-in">Read the data in</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#run-stream-processing-app">Run stream processing app</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#full-ksqldb-statements">Full ksqlDB Statements</a>
    </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Inventory</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../inventory/">Real-time Inventory</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Security</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Ssh attack</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../security/ssh-attack/">Detecting and Analyzing SSH Attacks</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Shared</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../shared/ccloud_launch/">Ccloud launch</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shared/ccloud_setup/">Ccloud setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shared/code_summary/">Code summary</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shared/connect/">Connect</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shared/manual_cue/">Manual cue</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../shared/manual_insert/">Manual insert</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">ksqlDB Recipes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Retail &raquo;</li>
        
      
        
          <li>Fleet management &raquo;</li>
        
      
    
    <li>Fleet Management</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="fleet-management">Fleet Management</h1>
<h2 id="what-is-it">What is it?</h2>
<p>More and more fleet management relies on knowing real-time information on vehicles, their locations, and vehicle telemetry.
This enables businesses to improve route efficiency, fuel efficiency, automate service schedules, etc.</p>
<p>TODO--add diagram</p>
<h2 id="get-started">Get Started</h2>
<p>Click below to automatically launch this recipe in Confluent Cloud (alternatively: follow the step-by-step instructions that follow).</p>
<p><a href="https://www.confluent.io/confluent-cloud/tryfree/"><img src="../../img/launch.png" /></a></p>
<h2 id="step-by-step">Step-by-step</h2>
<h3 id="setup-your-environment">Setup your Environment</h3>
<p>Setup your environment in <a href="https://www.confluent.io/confluent-cloud/tryfree/">Confluent Cloud</a>, a fully-managed Apache Kafka service.</p>
<p>Then proceed with the recipe, which can be executed with <code>SQL</code> syntax using Confluent Cloud ksqlDB, which now has connector integration for reading and writing data to other data sources and sinks, as well as language for processing the data.</p>
<h3 id="read-the-data-in">Read the data in</h3>
<p>Confluent Cloud offers pre-built, fully managed, Apache KafkaÂ® Connectors that make it easy to instantly connect to popular data sources in the cloud.
You can use any connector, substitute your own preferred one for getting data into Confluent Cloud.
The principles are the same, just modify the connector configuration shown below to fit your data source, see <a href="https://docs.confluent.io/cloud/current/connectors/index.html">documentation</a> for details.</p>
<p>TODO</p>
<pre><code class="language-sql">-- Stream of fleet descriptions
CREATE SOURCE CONNECTOR fleet_description WITH (
  'connector.class'          = 'MongoDbAtlasSource',
  'name'                     = '&lt;my-connector-name&gt;',
  'kafka.api.key'            = '&lt;my-kafka-api-key&gt;',
  'kafka.api.secret'         = '&lt;my-kafka-api-secret&gt;',
  'connection.host'          = '&lt;database-host-address&gt;',
  'connection.user'          = '&lt;database-username&gt;',
  'connection.password'      = '&lt;database-password&gt;',
  'database'                 = '&lt;database-name&gt;',
  'collection'               = '&lt;database-collection-name&gt;',
  'poll.await.time.ms'       = '5000',
  'poll.max.batch.size'      = '1000',
  'copy.existing'            = 'true',
  'output.data.format'       = 'JSON'
  'tasks.max'                = '1');

-- Stream of current location of each vehicle in the fleet
CREATE SOURCE CONNECTOR fleet_location WITH (
  'connector.class'          = 'PostgresSource',
  'name'                     = 'confluent-postgresql-source',
  'kafka.api.key'            = '&lt;my-kafka-api-key&gt;',
  'kafka.api.secret'         = '&lt;my-kafka-api-secret&gt;',
  'connection.host'          = '&lt;my-database-endpoint&gt;',
  'connection.port'          = '5432',
  'connection.user'          = 'postgres',
  'connection.password'      = '&lt;my-database-password&gt;',
  'db.name'                  = '&lt;db-name&gt;',
  'table.whitelist'          = 'fleet_location',
  'timestamp.column.name'    = 'created_at',
  'output.data.format'       = 'JSON',
  'db.timezone'              = 'UTC',
  'tasks.max'                = '1');
</code></pre>
<p>Optional: If you do not have a real data source to connect to with properly formatted data, or you just want to execute this recipe without external dependencies, no worries!  You can manually insert values into the source streams in the next section.</p>
<h3 id="run-stream-processing-app">Run stream processing app</h3>
<p>TODO</p>
<pre><code class="language-sql">---------------------------------------------------------------------------------------------------
-- Register sources:
---------------------------------------------------------------------------------------------------
-- stream of locations:
CREATE STREAM locations (
        vehicle_id int,
        latitude float,
        longitude float,
        timestamp varchar
    ) with (
        kafka_topic = 'locations',
        value_format = 'json'
    );

-- fleet lookup table:
CREATE TABLE fleet (
        vehicle_id int,
        driver_id int,
        license bigint
    ) with (
        kafka_topic = 'descriptions',
        value_format = 'json'
    );

-- enrich fleet location stream with more fleet information:
CREATE STREAM fleet_location_enhanced AS
    SELECT
        vehicle_id,
        latitude,
        longitude,
        timestamp,
        f.driver_id,
        f.license
    FROM locations l
        LEFT JOIN fleet f ON l.vehicle_id = f.vehicle_id;
</code></pre>
<p>In the previous section <a href="#read-the-data-in">Read the data in</a>, if you did not have a real data source to connect to, you can now use ksqlDB to insert mock data into source topics with the following statements:</p>
<pre><code class="language-sql">INSERT INTO location (vehicle_id, latitude, longitude, timestamp) VALUES (5401, 16.7587537, 96.2482149, '2021-09-23T10:50:00.000Z');
INSERT INTO location (vehicle_id, latitude, longitude, timestamp) VALUES (5401, 16.004175, 120.7806412, '2021-09-27T06:39:00.000Z');
INSERT INTO location (vehicle_id, latitude, longitude, timestamp) VALUES (5402, 32.755613, 22.6377432, '2021-09-25T20:22:00.000Z');

INSERT INTO description (vehicle_id, driver_id, license_plate) VALUES (5401, 847383, 8852693196);
INSERT INTO description (vehicle_id, driver_id, license_plate) VALUES (5402, 922947, 1255144201);
INSERT INTO description (vehicle_id, driver_id, license_plate) VALUES (5403, 435309, 2132311746);
</code></pre>
<h2 id="full-ksqldb-statements">Full ksqlDB Statements</h2>
<p>Here is a complete view of all the recipe steps explained above.</p>
<pre><code class="language-sql">-- Stream of fleet descriptions
CREATE SOURCE CONNECTOR fleet_description WITH (
  'connector.class'          = 'MongoDbAtlasSource',
  'name'                     = '&lt;my-connector-name&gt;',
  'kafka.api.key'            = '&lt;my-kafka-api-key&gt;',
  'kafka.api.secret'         = '&lt;my-kafka-api-secret&gt;',
  'connection.host'          = '&lt;database-host-address&gt;',
  'connection.user'          = '&lt;database-username&gt;',
  'connection.password'      = '&lt;database-password&gt;',
  'database'                 = '&lt;database-name&gt;',
  'collection'               = '&lt;database-collection-name&gt;',
  'poll.await.time.ms'       = '5000',
  'poll.max.batch.size'      = '1000',
  'copy.existing'            = 'true',
  'output.data.format'       = 'JSON'
  'tasks.max'                = '1');

-- Stream of current location of each vehicle in the fleet
CREATE SOURCE CONNECTOR fleet_location WITH (
  'connector.class'          = 'PostgresSource',
  'name'                     = 'confluent-postgresql-source',
  'kafka.api.key'            = '&lt;my-kafka-api-key&gt;',
  'kafka.api.secret'         = '&lt;my-kafka-api-secret&gt;',
  'connection.host'          = '&lt;my-database-endpoint&gt;',
  'connection.port'          = '5432',
  'connection.user'          = 'postgres',
  'connection.password'      = '&lt;my-database-password&gt;',
  'db.name'                  = '&lt;db-name&gt;',
  'table.whitelist'          = 'fleet_location',
  'timestamp.column.name'    = 'created_at',
  'output.data.format'       = 'JSON',
  'db.timezone'              = 'UTC',
  'tasks.max'                = '1');

---------------------------------------------------------------------------------------------------
-- Register sources:
---------------------------------------------------------------------------------------------------
-- stream of locations:
CREATE STREAM locations (
        vehicle_id int,
        latitude float,
        longitude float,
        timestamp varchar
    ) with (
        kafka_topic = 'locations',
        value_format = 'json'
    );

-- fleet lookup table:
CREATE TABLE fleet (
        vehicle_id int,
        driver_id int,
        license bigint
    ) with (
        kafka_topic = 'descriptions',
        value_format = 'json'
    );

-- enrich fleet location stream with more fleet information:
CREATE STREAM fleet_location_enhanced AS
    SELECT
        vehicle_id,
        latitude,
        longitude,
        timestamp,
        f.driver_id,
        f.license
    FROM locations l
        LEFT JOIN fleet f ON l.vehicle_id = f.vehicle_id;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../inventory/" class="btn btn-neutral float-right" title="Real-time Inventory">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../fin-serv/denormalization/" class="btn btn-neutral" title="Change Data Capture (CDC) for Orders"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../fin-serv/denormalization/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../inventory/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
